!function(e){function t(t,n,a){n=e(n).first()||n;var r=t.offset().top,i=t.offset().left,s=a.position.split(/,?\s+/),o=s[0],f=s[1];r-=n.outerHeight()-a.offset[0],i+=t.outerWidth()+a.offset[1],/iPad/i.test(navigator.userAgent)&&(r-=e(window).scrollTop());var u=n.outerHeight()+t.outerHeight();"center"==o&&(r+=u/2),"bottom"==o&&(r+=u);var l=t.outerWidth();return"center"==f&&(i-=(l+n.outerWidth())/2),"left"==f&&(i-=l),{top:r,left:i}}function n(e){function t(){return this.getAttribute("type")==e}return t.key='[type="'+e+'"]',t}function a(n,a,i){function s(t,n,a){if(i.grouped||!t.length){var s;if(a===!1||e.isArray(a)){s=r.messages[n.key||n]||r.messages["*"],s=s[i.lang]||r.messages["*"].en;var o=s.match(/\$\d/g);o&&e.isArray(a)&&e.each(o,function(e){s=s.replace(this,a[e])})}else s=a[i.lang]||a;t.push(s)}}var f=this,u=a.add(f);n=n.not(":button, :image, :reset, :submit"),GL.jHack||a.attr("novalidate","novalidate"),e.extend(f,{getConf:function(){return i},getForm:function(){return a},getInputs:function(){return n},reflow:function(){return n.each(function(){var n=e(this),a=n.data("msg.el");if(a){var r=t(n,a,i);a.css({top:r.top,left:r.left})}}),f},invalidate:function(t,a){if(!a){var r=[];e.each(t,function(e,t){var a=n.filter("[name='"+e+"']");a.length&&(a.trigger("OI",[t]),r.push({input:a,messages:[t]}))}),t=r,a=e.Event()}return a.type="onFail",u.trigger(a,[t]),a.isDefaultPrevented()||d[i.effect][0].call(f,t,a),f},reset:function(t){return t=t||n,t.removeClass(i.errorClass).each(function(){var t=e(this).data("msg.el");t&&(t.remove(),e(this).data("msg.el",null))}).off(i.errorInputEvent+".v"||""),f},destroy:function(){return a.off(i.formEvent+".V reset.V"),n.off(i.inputEvent+".V change.V"),f.reset()},checkValidity:function(t,a){t=t||n,t=t.not(":disabled");var r={};if(0!=i.filterByName&&(t=t.filter(function(){var t=e(this).attr("name");return r[t]?void 0:(r[t]=!0,e(this))})),!t.length)return!0;if(a=a||e.Event(),a.type="onBeforeValidate",u.trigger(a,[t]),a.isDefaultPrevented())return a.result;var l=[];t.each(function(){if(e(this).is(":visible")){var t=[],n=e(this).data("messages",t),r=o&&n.is(":date")?"onHide.v":i.errorInputEvent+".v";if(n.off(r),e.each(c,function(){var r=this,o=r[0];if(n.filter(o).length){var l=r[1].call(f,n,e.trim(n.val()));if(l!==!0){if(a.type="onBeforeFail",u.trigger(a,[n,o]),a.isDefaultPrevented())return!1;var c=n.attr(i.messageAttr);if(c)return t=[c],!1;s(t,o,l)}}}),t.length&&(l.push({input:n,messages:t}),n.trigger("OI",[t]),i.errorInputEvent&&n.on(r,function(e){f.checkValidity(n,e)})),i.singleError&&l.length)return!1}});var v=d[i.effect];if(!v)throw'Validator: cannot find effect "'+i.effect+'"';return l.length?(f.invalidate(l,a),!1):(v[1].call(f,t,a),a.type="onSuccess",u.trigger(a,[t]),t.off(i.errorInputEvent+".v"),!0)}}),e.each("onBeforeValidate,onBeforeFail,onFail,onSuccess".split(","),function(t,n){e.isFunction(i[n])&&e(f).on(n,i[n]),f[n]=function(t){return t&&e(f).on(n,t),f}}),i.formEvent&&a.on(i.formEvent+".V",function(e){return f.checkValidity(null,e)?(e.target=a,void(e.type=i.formEvent)):e.preventDefault()}),a.on("reset.V",function(){f.reset()}),n[0]&&n[0].validity&&n.each(function(){this.oninvalid=function(){return!1}}),a[0]&&(a[0].checkValidity=f.checkValidity),i.inputEvent&&n.on(i.inputEvent+".V",function(t){f.checkValidity(e(this),t)}),n.filter(":checkbox, select").filter("[data-required]").on("change.V",function(t){var n=e(this);(this.checked||n.is("select")&&e(this).val())&&d[i.effect][1].call(f,n,t)}),n.filter(":radio[data-required]").on("change.V",function(t){var n=e("[name='"+e(t.srcElement).attr("name")+"']");null!=n&&0!=n.length&&f.checkValidity(n,t)}),e(window).resize(function(){f.reflow()})}e.tools=e.tools||{version:"@VERSION"};var r,i=/\[type=([a-z]+)\]/,s=/^-?[0-9]*(\.[0-9]+)?$/,o=e.tools.dateinput,f=/^([a-z0-9_\.\-\+]+)@([\da-z\.\-]+)\.([a-z\.]{2,6})$/i,u=/^([a-zA-Z0-9]|[~`!@#$%\^&\*\(\)_\+-=\{\}\]\[:;\"'<>,\.\/\?]){6,16}$/,l=/^(https?:\/\/)?[\da-z\.\-]+\.[a-z\.]{2,6}[#&+_\?\/\w \.\-=]*$/i;r=e.tools.validator={conf:{grouped:!1,effect:"default",errorClass:"invalid",inputEvent:null,errorInputEvent:"keyup",formEvent:"submit",lang:"en",message:'<div class="errorMsg"><span><i class="text"></i></span></div>',messageAttr:"data-message",messageClass:"error",offset:[0,0],position:"center right",singleError:!1,zIndex:0,speed:"normal"},messages:{"*":{en:"Please correct this value"}},localize:function(t,n){e.each(n,function(e,n){r.messages[e]=r.messages[e]||{},r.messages[e][t]=n})},localizeFn:function(t,n){r.messages[t]=r.messages[t]||{},e.extend(r.messages[t],n)},fn:function(t,a,r){e.isFunction(a)?r=a:("string"==typeof a&&(a={en:a}),this.messages[t.key||t]=a);var s=i.exec(t);s&&(t=n(s[1])),c.push([t,r])},addEffect:function(e,t,n){d[e]=[t,n]}};var c=[],d={"default":[function(n){var a=this.getConf();e.each(n,function(n,r){var i=r.input;i.addClass(a.errorClass);var s=i.data("msg.el");if(!s){s=e(a.message).addClass(a.messageClass).appendTo(document.body);var o=i.data("validcode")||i.data("qsvalidcode")||i.attr("name");o&&s.addClass(o.replace(".","_")+"ErrorMsg"),a.zIndex&&s.css("z-index",a.zIndex),i.data("msg.el",s)}s.css({visibility:"hidden"}).find("p").remove(),e.each(r.messages,function(t,n){e("<p/>").html(n).appendTo(s.find("i"))}),s.outerWidth()==s.parent().width()&&s.add(s.find("p")).css({display:"inline"});var f=t(i,s,a);s.css({visibility:"visible",position:"absolute",top:f.top,left:f.left}).fadeIn(a.speed)})},function(t){var n=this.getConf();t.removeClass(n.errorClass).each(function(){var t=e(this).data("msg.el");t&&t.css({visibility:"hidden"})})}]};e.each("email,url,number".split(","),function(t,n){e.expr[":"][n]=function(e){return e.getAttribute("type")===n}}),e.fn.oninvalid=function(e){return this[e?"on":"trigger"]("OI",e)},r.fn(":password","请输入6-16位数字及字符组成的密码.",function(e,t){return e.attr("pattern")?!0:!t||u.test(t)}),r.fn(":email","请输入正确的邮箱地址",function(e,t){return!t||f.test(t)}),r.fn(":url","Please enter a valid URL",function(e,t){return!t||l.test(t)}),r.fn(":file","请上传正确的文件格式",function(t,n){var a,r=t.attr("data-postfix");return"img"===r&&(a="^.*.(jpg|JPG|gif|GIF|png|PNG)$"),!n||new RegExp("^"+a+"$").test(e(t).data("src"))}),r.fn(":number","Please enter a numeric value.",function(e,t){return s.test(t)}),r.fn("[max]","Please enter a value no larger than $1",function(e,t){if(""===t||o&&e.is(":date"))return!0;var n=e.attr("max");return parseFloat(t)<=parseFloat(n)?!0:[n]}),r.fn("[min]","Please enter a value of at least $1",function(e,t){if(""===t||o&&e.is(":date"))return!0;var n=e.attr("min");return parseFloat(t)>=parseFloat(n)?!0:[n]}),r.fn("[data-required]","不能为空",function(e,t){return e.is(":checkbox")?e.is(":checked"):!!t&&t!=e.data("tips")}),r.fn("[pattern]",function(e,t){return""===t||new RegExp("^"+e.attr("pattern")+"$").test(t)}),r.fn(":radio[data-required]","Please select an option.",function(t){{var n=!1;e("[name='"+t.attr("name")+"']").each(function(t,a){e(a).is(":checked")&&(n=!0)})}return n?!0:!1}),r.fn("[data-equals]","必须和$1相同",function(e){var t=e.attr("data-equals"),n=this.getInputs().filter("[name="+t+"]");return e.val()==n.val()?!0:[t]}),r.fn("[data-disease]","请输入合适疾病",function(e,t){return!!t&&t!=e.data("tips")&&!new RegExp("^[0-9]+$|^[a-zA-Z]+$").test(t)}),e.fn.validator=function(t){var n=this.data("validator");return n&&(n.destroy(),this.removeData("validator")),t=e.extend(!0,{},r.conf,t),this.is("form")?this.each(function(){var r=e(this);n=new a(r.find(":input"),r,t),r.data("validator",n)}):(n=new a(this,this.eq(0).closest("form"),t),this.data("validator",n))}}(jQuery);