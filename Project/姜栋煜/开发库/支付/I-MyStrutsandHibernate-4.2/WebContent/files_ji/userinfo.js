GH.run(function(){function t(t,i){setTimeout(function(){i?location.reload():$(t).hide()},3e3)}var i={cache:{},init:function(){var t=this,i=$("#patientListDv").find(".js-edit"),e=t.patientNum=i.length;6>e&&$("#addPatientBtn").show(),t.initListener()},initListener:function(){var t=this,i=t.patientListDv=$("#patientListDv").find("table");$("#addPatientBtn").click(function(){t.showAdd()}),$(".close-link").click(function(){t.hideAll()}),$("#patientUpdateForm").delegate(".del-card","click",function(){t.deleteCard($(this))}),i.delegate(".js-detail","click",function(){t.highLightTr(this),t.detail(this.name)}),i.delegate(".js-edit","click",function(){t.highLightTr(this),t.edit(this)}),i.delegate(".js-del","click",function(){t.highLightTr(this),t.del(this)}),$("#updateBtn").click(function(){t.update()}),$("#addBtn").click(function(){t.add()})},disableAddBtn:function(t){var i=$("#addPatientBtn");0==t?i.show():i.hide()},hideAll:function(t){function i(i){i!=t&&$(i).hide()}var e=$("#patientAddForm"),a=$("#patientUpdateForm");this.destroyForm(e),this.destroyForm(a),i("#patientAddDv"),i("#patientUpdateDv"),i("#patientDetailDv")},scrollToShow:function(){scrollTo(0,200)},showAdd:function(){var t=this,i=$("#patientAddForm");t.hideAll("#patientAddDv");var e=$GU.htmlspecialcharsDecode($("#editTemplate").html()),a=GreenLine.Util.compileTmpl(e);$("#patientAddDv").find(".content").html(a),$("#patientAddDv").find(".js-edit-box").remove(),$("#patientAddDv").show(),t.initForm(i),i.find(".birthday-input").datepicker("setDate","1987-01-01")},getPatientInfo:function(t,i){var e=this,a=e.cache;return a[t]?void i(a[t]):void e.request({url:"/my/patients/patientdetail/ajax/"+t,call:function(e){a[t]=e,i(e)}})},detail:function(t){var i=this;return i.hideAll("#patientDetailDv"),i.detailId==t&&i.cache[t]?void $("#patientDetailDv").show():(i.detailId=t,void i.getPatientInfo(t,function(t){var e=t.patientCardDOList,a=['<div class="detail-title">基本信息</div>','<ul class="gfm-line">','<li class="gfm-item">','<span class="gfm-left">就诊人姓名：</span>','<span class="text-value">',t.patient_name||"","</span>","</li>",'<li class="gfm-item">','<span class="gfm-left">与我的关系：</span>','<span class="text-value">',t.rela_str,"</span>",'<span id="err_rel"></span>',"</li>",'<li class="gfm-item">','<span class="gfm-left">身份证：</span>','<span class="text-value">',t.patient_cert_no||"","</span>","</li>",'<li class="gfm-item">','<span class="gfm-left">性别：</span>','<span class="text-value">',1==t.patient_sex?"男":"女","</span>","</li>",'<li class="gfm-item">','<span class="gfm-left">出生年月：</span>','<span class="text-value">',t.patient_birthday||"","</span>","</li>",'<li class="gfm-item">','<span class="gfm-left">联系电话：</span>','<span class="text-value">',t.patient_mobile||"","</span>",'<span id="err_mobile"></span>',"</li>",'<li class="gfm-item">','<span class="gfm-left">居住地：</span>','<span class="text-value">',t.patientAddr||"","</span>","</li>",'<li class="gfm-item">','<span class="gfm-left">医保卡：</span>','<span class="text-value">',t.patient_med_no||"","</span>","</li>","</ul>"];if(e){var n=e.length;if(n>0){a.push('<div class="detail-sep"></div>','<div class="detail-title">门诊卡信息</div>','<ul class="card-list">');for(var s=0;n>s;s++){var o=e[s];a.push("<li>",s+1,"、",o.hospitalname," ：",o.card_no,"</li>")}a.push("</ul>")}}i.scrollToShow(),$("#patientDetailDv").show().find(".content").html(a.join(""))}))},selectForIdcard:function(t){var i=t.val(),e=$GU.getBirthdayAndSexByIdNo(i),a=e[0],n=e[1];null!=a&&t.parents("ul").find(".birthday-input").datepicker("setDate",a),null!=n&&3>(n>0)&&t.parents("ul").find("input.js-sex-radio[value="+n+"]").attr("checked",!0)},initForm:function(t){var i=this;$GW.Location.init(t);var e=t.find(".birthday-input"),a={changeYear:!0,changeMonth:!0,yearRange:"1900:2016",yearSuffix:"年",maxDate:new Date,showOn:"both",defaultDate:e.val()||"1987-01-01",buttonImageOnly:!0};if($GU.isIE6()){var n=t.find("select");e.click(function(){n.hide()}),a.onClose=function(){n.show()}}e.datepicker(a),t.find(".js-idcard-ipt").change(function(){i.selectForIdcard($(this))});var s;(s=t.data("validator"))&&s.destroy(),t.validator({formEvent:"null"})},destroyForm:function(t){var i;(i=t.data("validator"))&&(t.data("validator").reset(),i.destroy())},deleteCard:function(t){$GMC.load(t,{title:"删除门诊卡",confirm:{btnTxt:"删除",url:"/my/patient/deleteUserPatientCard/"+t.attr("pcid"),message:"确定删除此门诊卡吗？"},success:"删除成功",fail:"删除失败，请稍后再试",callback:function(){t.parent().remove()}})},edit:function(t){var i=this,e=t.name,a=!1;e.indexOf("myself")>-1&&(e=e.replace("myself",""),a=!0),i.hideAll("#patientUpdateDv");var n=$("#patientUpdateForm");return n.data("patientId")==e?void $("#patientUpdateDv").show():(n.data("patientId",e),i.edittingId=e,void i.getPatientInfo(e,function(t){var e,s=t.patientCardDOList;e=a?$("#editMyselfTemplate").html():$("#editTemplate").html(),e=$GU.htmlspecialcharsDecode(e);var o=['<input type="hidden" name="encodePatientId" value="',t.encodePatientId,'" />','<div class="detail-title">基本信息</div>',GreenLine.Util.compileTmpl(e,t)];if(s){var r=s.length;if(r>0){o.push('<div class="detail-sep"></div>','<div class="detail-title">门诊卡信息</div>','<ul class="card-list">');for(var l=0;r>l;l++){var d=s[l];o.push('<li class="gfm-item">','<label class="gfm-left" title="',d.hospitalname,'">',d.hospitalname,"：</label>",'<input type="text" class="gfm-input" name="cardnos" value="',d.card_no,'">','<input type="hidden" name="hospitaluuids" value="',d.hospital_uuid,'">','<a title="删除" class="del-card" href="javascript:void(0)" hidefocus="true" pcid="',d.encodeId,'">','<span class="gi gi-del"></span>',"</a>","</li>")}o.push("</ul>")}}i.scrollToShow();var c=$("#patientUpdateDv").find(".content").html(o.join(""));2==t.patient_sex?c.find(".js-sex-female").attr("checked","checked"):c.find(".js-sex-radio:eq(0)").attr("checked","checked"),c.find(".js-relationship-sel").val(t.relationship),a||c.find(".js-add-box").remove(),$("#patientUpdateDv").show(),i.initForm(n)}))},getAddress:function(t){return t.find(".js-location-province").find("option:selected").text()+t.find(".js-location-city").find("option:selected").text()+t.find(".js-location-area").find("option:selected").text()+t.find(".js-location-detail").val()},addTr:function(t,i){var e=t.find(".js-relationship-sel").find(":selected").text(),a=$("#patientListDv tbody"),n=a.find("tr").has("th"),s=n.length,o=!1;n.each(function(t,r){r=$(r),r.html().indexOf(e)>-1&&(o=!0,s-1>t?$(n.get(t+1)).before(i):a.append(i))}),o||a.append("<tr><th>"+e+'</th><th colspan="4"></th></tr>').append(i)},removeTr:function(t,i){var e=$("#patientTr"+t),a=e.prev(),n=e.next();a.find("th").length>0&&(0==n.length||n.find("th").length>0)&&a.remove(),1!=i&&e.remove()},update:function(){var t=this,i=$("#patientUpdateForm");return i.data("validator").checkValidity()?void t.request({url:"/my/patient/doUpdate",method:"post",forbitDuplicate:!0,data:i.serialize(),call:function(){t.hideAll();var e=i.data("patientId"),a=$("#patientTr"+e),n=a.find(".js-edit").attr("name");n.indexOf("myself")>-1?a.children().last().prev().html(t.getAddress(i)):a.children().first().html(i.find("input[name=patient_name]").val()).next().html($GU.maskStr(i.find("input[name=patient_mobile]").val(),4,8)).next().html($GU.maskStr(i.find("input[name=patient_cert_no]").val(),5,14)).next().html(t.getAddress(i));var s=i.find(".js-relationship-sel").val(),o=t.cache[e];o?(s!=o.relationship&&void 0!=s&&(t.removeTr(e,!0),t.addTr(i,a)),t.cache[e]=null,a.data("relationship",s)):a.data("relationship")&&(s!=a.data("relationship")&&void 0!=s&&(t.removeTr(e,!0),t.addTr(i,a)),a.data("relationship",s))}}):!1},add:function(){var t=this,i=$("#patientAddForm");return i.data("validator").checkValidity()?void $GD.init({title:"温馨提醒",extClass:"gm-tips-dialog",content:"就诊人信息一经填写，姓名和身份证号码无法修改，删除操作也是有数量限制的，请确认填写是否正确.",okTxt:"立即保存",cancelTxt:"返回修改",okCall:function(){t.request({url:"/my/patient/doAdd",method:"post",forbitDuplicate:!0,data:i.serialize(),call:function(e){t.hideAll();var a=e,n=i.find("input[name=patient_cert_no]").val();n=n.substring(0,6)+"*********"+n.substring(n.length-3);var s=['<tr id="patientTr',a,'">',"<td>",i.find("input[name=patient_name]").val(),"</td>","<td>",$GU.maskStr(i.find("input[name=patient_mobile]").val(),4,8),"</td>","<td>",$GU.maskStr(i.find("input[name=patient_cert_no]").val(),5,14),"</td>","<td>",t.getAddress(i),"</td>","<td>",'<a name="',a,'" href="javascript:void(0)" hidefocus="true" class="js-detail">详情</a> ','<a name="',a,'" href="javascript:void(0)" hidefocus="true" class="js-edit">修改</a>','<a name="',a,'"  href="javascript:void(0)" hidefocus="true" class="js-del">删除</a>',"</td>","</tr>"].join("");t.addTr(i,s);var o=++t.patientNum;o>=6&&$("#addPatientBtn").hide()}})}}):!1},del:function(t){{var i=this,e=t.name;$(t).data("type")}$GMC.load($(t),{title:"删除联系人",confirm:{btnTxt:"删除",url:"/my/patient/doRemove/ajax/"+e,message:"每个账号每月删除就诊人操作是有数量限制的，请确认是否需要删除."},success:"删除成功",fail:" ",callback:function(){i.removeTr(e);var t=--i.patientNum;6>t&&$("#addPatientBtn").show();i.edittingId==e&&$("#patientUpdateDv").hide(),i.detailId==e&&$("#patientDetailDv").hide()}})},highLightTr:function(t){$("#patientListDv").find("tr").each(function(){$(this).hasClass("hl")&&$(this).removeClass("hl")});var i=$(t).parent().parent();i.addClass("hl"),setTimeout(function(){i.removeClass("hl")},5e3)},request:function(i){var e=this,a=i.url,n=i.method||"get",s=i.call;i.forbitDuplicate&&e.submitting||(e.showLoading(),$.ajax({url:a,type:n,cache:!1,data:i.data,success:function(o){if(e.showLoading(!1),GreenLine.Util.logs("1",a,n,o.code),"500"==o.code||o.hasError)$("#errorTipsDv").show().find(".content").html(i.errTips||o.message),t("#errorTipsDv");else{var r=i.succTips||o.message;r&&($("#succTipsDv").show().find(".content").html(r),t("#succTipsDv")),s&&s(o.data)}},error:function(){e.showLoading(!1)}}))},showLoading:function(t){var i=this;0==t?i.submitting=!1:(i.submitting=!0,$("#errorTipsDv").hide(),$("#succTipsDv").hide())}};$("#patientList").length>0&&i.init();var e={init:function(){var t=this;$("#perinform").validator({formEvent:"null"}),$("#sendMailLink").click(function(){t.sendMail()}),$("#updateUserInfo").click(function(){t.save()}),$("#validCodeBtn").click(function(){$("#perinform").data("validator").reset(),t.sendMeg(this)}),$("#editUserNamebt").on("click",function(){var t=$("#editUserNameForm"),i=$(".editUserName").validator();i.data("validator").checkValidity()&&GreenLine.Modal2.confirm.load($(this),{title:"修改姓名",icon:'<div style="float: left;width:100px;">&nbsp;</div>',okTxt:"确认",message:'<i class="gi-confirm-ask" style="padding:5px;"></i>确定修改吗？',call:function(){setTimeout(function(){t.submit()},0)}})}),$("#editUserMobilebt").on("click",function(){var t=$("#editUserMobileForm");t.validator({formEvent:"null"}),t.data("validator").checkValidity()&&GreenLine.Modal2.confirm.load($(this),{title:"修改手机号",icon:'<div style="float: left;width:100px;">&nbsp;</div>',okTxt:"确认",message:'<i class="gi-confirm-ask" style="padding:5px;"></i>确定修改吗？',call:function(){t.submit()}})});{var i=$("#addrOrMedNo");i.find("#Address").validator(),i.find("#patientMedNo").validator()}i.find(".js-Setvalue").click(function(){$(this).hide();var t=$(this).parent().parent();t.find(".gfm-input").show(),t.find(".js-action").css("display","inline-block")}),i.find(".js-modifyValue").click(function(){$(this).hide();var t=$(this).parent().parent();t.find(".js-value").hide();var i=t.find(".js-value").text();t.find(".gfm-input").val(i).show(),t.find(".js-action").css("display","inline-block")}),i.find(".js-action").click(function(){var t=$(this),e=$(this).parent().find(".gfm-input");if(e.data("validator").checkValidity()){var a=i.find("#encodeId").val(),n=$.trim(e.val()),s={};s="patientMedNo"==e.attr("id")?{encodeUserId:a,patientMedNo:n}:{encodeUserId:a,address:n},$.ajax({url:"/my/modify/addrOrMedNo",type:"post",data:s,cache:!1,success:function(){t.parent().find(".js-value").text(e.val()).show(),t.parent().find(".js-modifyValue").show(),t.hide(),e.hide(),$("#succTipsDv").find(".content").text("修改成功！"),$("#succTipsDv").show(),setTimeout(function(){$("#succTipsDv").hide()},2e3)},error:function(){$("#errorTipsDv").find(".content").text(result.message),$("#errorTipsDv").show(),setTimeout(function(){$("#errorTipsDv").hide()},2e3)}})}})},sendMeg:function(t){var i=$("#perinform").find(".emailRegMoblie").validator(),e=$("#perinform").find(".emailRegMoblie");i.data("validator").checkValidity()&&GreenLine.Util.sendMobileMsg($(t),{type:"UPDATE_PROFILE",mobileNo:e.val(),errorDiv:$("#errorTipsDv"),successDiv:$("#succTipsDv")})},sendMail:function(){var t=this;t.request({url:"/my/sendemail?email="+encodeURIComponent($("#email").val()),type:"get"})},save:function(){var t=this;if(!t.submitting)return $("#perinform").data("validator").checkValidity()?void t.request({url:"/my/updateprofile",method:"post",data:$("#perinform").serialize()}):!1},request:function(i){var e=this,a=i.url,n=i.method||"get",s=i.data;e.showLoading(),GreenLine.Util.logs("1",a,n),$.ajax({dataType:"json",cache:!1,type:n,url:a,data:s,success:function(i){null!=i.data?location.href=$GC.guahaoServer+i.data:(e.showLoading(!1),i.hasError?$("#errorTipsDv").show().find(".content").html(i.message):($("#succTipsDv").show().find(".content").html(i.message),t("#succTipsDv",!0),7==$("#perinform").find("input[name='type']").val()&&(location.href=$GC.guahaoServer+"/tdb/goapply")))},error:function(){e.showLoading(!1)}})},showLoading:function(t){var i=this;0==t?i.submitting=!1:(i.submitting=!0,$("#errorTipsDv").hide(),$("#succTipsDv").hide())}};$("#userinfo").length>0&&e.init();var a={init:function(){var i=$("#modPswForm");i.validator({formEvent:"null"}),$("#submitButtom").click(function(){i.data("validator").checkValidity()&&i.submit()}),t("#succTipsDv"),t("#errorTipsDv")}};$("#modifyPassword").length>0&&a.init();var n={init:function(){var t=this;t.initListener()},initListener:function(){var t=$(".order-list");if(t.find(".order-states-chose").hover(function(){$(this).find("ul").show()},function(){$(this).find("ul").hide()}),t.find(".cancelModal").on("click",function(){GreenLine.Modal2.confirmModal.load($(this),{title:"取消预约",confirm:{message:"您确定取消预约吗?<span class='tip'>订单取消次数有限（5次/月），若到达上限当月无法预约。</span>",btnTxt:"取消预约",url:"/my/ordercancel/"+$(this).attr("value")+"/"+$(this).next().val()},callbackOk:function(){location.reload()}})}),t.find(".reSendMsg").on("click",function(){GreenLine.Modal2.confirmModal.load($(this),{title:"补发短信",success:"发送成功",fail:"发送失败",modalId:"gm-reSendMsg",confirm:{message:"您确定补发短信吗?",btnTxt:"发送",url:"/my/order/resendmsg/"+$(this).attr("value")},callbackOk:function(){location.reload()}})}),t.find("form").length>0){var i=t.find("#orderFilter");t.find("#startTime").datepicker({defaultDate:"0",changeYear:!0,changeMonth:!0,yearSuffix:"年",showOn:"both",buttonImageOnly:!0}),t.find("#endTime").datepicker({defaultDate:"0",changeYear:!0,changeMonth:!0,yearSuffix:"年",showOn:"both",buttonImageOnly:!0}),i.find("#sureBt").click(function(){i.submit()})}}};$(".order-list").length>0&&n.init();var s={init:function(){var t=this,i=$("#myFav-list"),e=$("#myFav-Tabs");i.find(".g-tabs-container").glTabs({content:".g-tab-content",tabs:".g-tabs",onCls:"current"}),$("#my-fav-num").find("a").on("click",function(){var t=$(this).parents("#my-fav-num").find("a").index($(this));return e.find("a:eq("+t+")").trigger("click"),!1}),i.find(".del").on("click",function(){var i=this;GreenLine.Modal2.confirmModal.load($(this),{title:"取消收藏",confirm:{message:"您确定取消收藏吗?",btnTxt:"取消收藏",url:"/my/favorite/del/"+$(this).attr("this-id")+"/"+$(this).attr("this-type")+"/"+$(this).attr("this-fid")},callback:function(){t.cancelCallBack(i)}})}),i.find(".list").each(function(){$(this).glPagination({resultNum:10}),$(this).find("li").hover(function(){$(this).find("a.del,a.ask-question").show()},function(){$(this).find("a.del,a.ask-question").hide()})}),i.find(".js-ask-question").click(function(){var t=$(this).next();GreenLine.Qa.showAskDialog({title:"向该医生的患友们提问",showDisease:!0,urlParams:"?expertId="+t.find("input[name=expertId]").val(),extParams:t.html()})})},cancelCallBack:function(t){var i=$(t).parents("ul"),e=i.find("li").index($(t).parent()),a=0,n=!0,s="";if($(t).parent().parent().hasClass("list_expert")&&(a=parseInt($("#fav-list-expert").html()),$("#fav-list-expert").html(a-1),1===a&&(s="<span>暂无收藏医生</span>",n=!1)),$(t).parent().parent().hasClass("list_hospdept")&&(a=parseInt($("#fav-list-dept").html()),$("#fav-list-dept").html(a-1),1===a&&(s="<span>暂无收藏科室</span>",n=!1)),$(t).parent().parent().hasClass("list_hosp")&&(a=parseInt($("#fav-list-hos").html()),$("#fav-list-hos").html(a-1),1===a&&(s="<span>暂无收藏医院</span>",n=!1)),n?$(t).parent().remove():$(t).parent().html(s),i.data("pagination")){var o=i.data("pagination");o.refresh(e)}}};$("#myFav-list").length>0&&s.init();var o={init:function(){var t=this;$("#get_checkcode").on("click",function(){var i=$(this);if(i.hasClass("disabled"))return!1;i.addClass("disabled");var e={mobile:$("#order-sms-Content").val(),context:$("#order-phone").val()};$.ajax({url:"/my/reservation/resend",type:"GET",data:e,cache:!1,success:function(){i.html("短信凭证已发送！")},error:function(){i.html("短信发送失败，请稍后再试！")}});var a=59,n=1e3;setTimeout(t.changeHtml(this,a,n),5e3)}),$("#myOrder-detail").find(".cancelModal").on("click",function(){GreenLine.Modal2.confirmModal.load($(this),{title:"取消预约",confirm:{message:"您确定取消预约吗?<span class='tip'>订单取消次数有限（5次/月），若到达上限当月无法预约。</span>",btnTxt:"取消预约",url:"/my/ordercancel/"+$(this).attr("value")+"/"+$(this).next().val()},callbackOk:function(){location.reload()}})}),$("#printOrderBtn").click(function(){return window.print(),!1})},changeHtml:function(t,i,e){function a(){var s=10>i?"0"+i:i;$(t).html(s+"秒后可重发"),0==i?($(t).html("重新发送短信凭证"),$(t).removeClass("disabled"),clearTimeout(n)):n=setTimeout(a,e),i--}var n;a()}};$("#myOrder-detail").length>0&&o.init();var r={init:function(){this.bindBtns(),$("#profie-mob").validator({formEvent:"null"}),$("#profile-email").validator({formEvent:"null"})},getNameLength:function(t){for(var i=t.length,e=0,a=0;i>a;a++)t.charCodeAt(a)<27||t.charCodeAt(a)>126?e+=2:e++;return e},bindBtns:function(){var t=$("#userinfo-display"),i=$("#domob-val"),e=$("#update-info"),a=$("#profile-validEmailBtn"),n=this;a.click(function(){$("#errorTipsDv,#succTipsDv").hide(),$("#profile-email").data("validator").checkValidity()&&$("#profile-email").submit()}),e.click(function(){$("#errorTipsDv,#succTipsDv").hide(),$("#profie-mob").data("validator").checkValidity()&&$("#profie-mob").submit()}),i.on("click",function(){$("#errorTipsDv,#succTipsDv").hide();var t=$("#bdMoblie").validator(),e=$("#bdMoblie");t.data("validator").checkValidity()&&GreenLine.Util.sendMobileMsg(i,{type:"UPDATE_PROFILE",mobileNo:e.val(),errorDiv:$("#errorTipsDv"),successDiv:$("#succTipsDv")})}),$("#writeNickName").on("click",function(){var i=t.find("input.nickName"),e=i.val(),a=$("#writeNickNameForm");len=n.getNameLength(e),4>len||len>30?$("#errorTipsDv").show().find(".content").html("您输入的字符长度不符。"):null!==e.match(/^([\u4e00-\u9fa5]|[\ufe30-\uffa0]|[A-Za-z0-9_])*$/)?a.submit():$("#errorTipsDv").show().find(".content").html("您输入的字符不符合要求，请仔细检查。")});var s=$("#authUserMobile"),o=$("#authUserEmail");s.on("click",function(){t.find(".auth-line").addClass("hide"),t.find(".val-mob").removeClass("hide"),t.find(".mob").removeClass("hide")}),o.on("click",function(){t.find(".auth-line").addClass("hide"),t.find(".liEmail").addClass("hide"),t.find(".val-email").removeClass("hide"),t.find(".email").removeClass("hide")})}},l={init:function(){$("#modify-profile-from").validator({formEvent:"null"}),this.sendMessage(),this.checkForm()},sendMessage:function(){$("#validMobileBtn").click(function(){$("#errorTipsDv,#succTipsDv").hide();var t=$(".emailRegMoblie").validator(),i=$(".emailRegMoblie");t.data("validator").checkValidity()&&($("#modify-profile-from").data("validator").reset(),GreenLine.Util.sendMobileMsg($(this),{type:"UPDATE_PROFILE",mobileNo:i.val(),errorDiv:$("#errorTipsDv"),successDiv:$("#succTipsDv")}))})},checkForm:function(){$("#modifySub").click(function(){$("#errorTipsDv,#succTipsDv").hide(),$("#modify-profile-from").data("validator").checkValidity()&&$("#modify-profile-from").submit()})}};if($("#modify-profile").length>0){var d=window.location.search;d&&"?fg=true"==d&&$GM.loadMsgModal($(this),{message:"为了您的预约挂号体验更加顺畅，请先完善您的个人信息",id:"gm-msg"}),r.init(),l.init()}var c={init:function(){var t=this;t.initListener()},initListener:function(){var t=$("#person-plus-list").find(".order-list");t.find(".cancel-apply").click(function(){GreenLine.Modal2.confirmModal.load($(this),{title:"取消就医申请",confirm:{message:"您确定取消就医申请吗?",btnTxt:"取消就医申请",url:"/my/haoyuancancel/"+$(this).attr("data-id")},callbackOk:function(){location.reload()}})})}};$("#person-plus-list").length>0&&c.init();var f={init:function(){var t=this;t.doHide(),t.doUploadImg();var i=$(".container").find("#imgPath").val();if(""!=i){var e=$(".container").find("#loadImg").val();$(".container").find("#loadTarget").attr("src",e),$(".container").find("#previewTarget1").attr("src",e),$(".container").find("#previewTarget2").attr("src",e);var a=$(".container").find("#loadTarget");a[0].onload=function(){t.doJcrop()}}},doHide:function(){$("#succTipsDv").hasClass("hide")||setTimeout(function(){$("#succTipsDv").hide()},2e3),$("#errorTipsDv").hasClass("hide")||setTimeout(function(){$("#errorTipsDv").hide()},2e3)},doUploadImg:function(){function t(t){var i=".gif,.png,.jpg,.jpeg";if(t.value.length>0){var e=t.value.substring(t.value.lastIndexOf(".")).toLowerCase();return i.indexOf(e)>-1?!0:!1}}$("#upload_img").click(function(){var i=$("#imgFile").validator(),e=$("#imgFile");i.data("validator").checkValidity()&&(t(e[0])?$("#uploadImgForm").submit():($("#errorTipsDv .content").text("图片格式不符合要求"),$("#errorTipsDv").removeClass("hide").show(),f.doHide()))})},doJcrop:function(){function t(){$("#compressForm").submit()}function i(t){if(o.show(),d.show(),$("#txtX1").val(t.x),$("#txtY1").val(t.y),$("#txtW").val(t.w),$("#txtH").val(t.h),parseInt(t.w)>0){var i=p/t.w,e=u/t.h,s=v/t.w,r=m/t.h;l.css({width:Math.round(i*a)+"px",height:Math.round(e*n)+"px",marginLeft:"-"+Math.round(i*t.x)+"px",marginTop:"-"+Math.round(e*t.y)+"px"}),h.css({width:Math.round(s*a)+"px",height:Math.round(r*n)+"px",marginLeft:"-"+Math.round(s*t.x)+"px",marginTop:"-"+Math.round(r*t.y)+"px"})}}var e,a,n,s=$(".container").find("#imageSizeMin").val(),o=$("#preview-pane"),r=$("#preview-pane .preview-container"),l=$("#preview-pane .preview-container img"),d=$("#preview-pane1"),c=$("#preview-pane1 .preview-container"),h=$("#preview-pane1 .preview-container img"),p=r.width(),u=r.height(),v=c.width(),m=c.height();$("#loadTarget").Jcrop({onChange:i,onSelect:i,setSelect:[0,0,s,s],bgColor:"white",bgOpacity:.5,aspectRatio:1},function(){var t=this.getBounds();a=t[0],n=t[1],e=this,i({h:s,w:s,x:0,x2:s,y:0,y2:s}),o.appendTo(e.ui.holder),d.appendTo(e.ui.holder),$(".container").show()}),$("#saveBt").click(function(){var i=$("#txtX1").val(),e=$("#txtY1").val(),a=$("#txtW").val(),n=$("#txtH").val();""==i||""==e||""==a||""==n?($("#errorTipsDv .content").text("请框选头像！"),$("#errorTipsDv").removeClass("hide").show(),f.doHide()):setTimeout(t,0)}),$("#cancelBt").click(function(){e.setSelect([0,0,s,s])})}};$("#headPic").length>0&&f.init(),$(".gp-person .js-user-avatar").length>0&&$(".gp-person .js-user-avatar").hover(function(){$(this).find("a").show()},function(){$(this).find("a").hide()});var h=$("#gm-share-confirm");$(".gp-person .js-share").click(function(){var t=$(this).data("orderno");return h.find(".js-yes").attr("href","/commentexpert/orderconfirm/"+t),h.find(".js-no").attr("href","/commentexpert/ordernotreated/"+t),$GM.loadDirectModal($(this),h),!1});var p={type:0,init:function(){this.changetype(),this.dosubmit();var t=$(".consult-detail-box").find(".js-input .tabs a");1===t.length&&(t.addClass("on"),this.type=parseInt(t.eq(0).data("type"),10));var i=$(".glRating");i.glRating(),i.hover(function(){$(this).find("input.rating").data("msg.el")&&$(this).find("input.rating").data("msg.el").hide()})},changetype:function(){var t=this;$(".consult-detail-box").find(".js-input .tabs a").click(function(){$(this).hasClass("on")||($(".consult-detail-box").find(".js-form1").data("validator").reset(),$(".J_ratingbox").hide(),$(this).parent().find("a.on").removeClass("on"),$(this).addClass("on"),"0"==$(this).data("type")?(t.type=0,$("#askContent").attr("data-required","1")):"1"==$(this).data("type")?(t.type=1,$("#askContent").attr("data-required","1")):"2"==$(this).data("type")&&(t.type=2,$(".J_ratingbox").show(),$("#askContent").removeAttr("data-required")))})},dosubmit:function(){var t=this,i=$(".consult-detail-box").find(".js-form1"),e=$(".consult-detail-box").find(".js-form2"),a=$(".consult-detail-box").find(".js-form3");i.validator({formEvent:"null"}),i.find(".js-action").click(function(){if(i.data("validator").checkValidity()){var n=i.find("#askContent").val(),s=i.find("#Attitude").val(),o=i.find("#Effect").val(),r="",l="";return 0==t.type?(r=i.attr("action"),l=i.serialize()):1==t.type?(r=e.attr("action"),l=e.serialize()+"&content="+n):2==t.type&&(r=a.attr("action"),l=a.serialize()+"&content="+n+"&attitude="+s+"&effect="+o),$.ajax({dataType:"json",cache:!1,url:r,type:"POST",data:l,success:function(e){void 0==e.hasError||e.hasError||(0==t.type?(i.find(".js-consultdom  p").text(n),i.append(i.find(".js-consultdom").html())):1==t.type?i.append("<ul><li class='sucmsg'>您的感谢信已成功发给医生！</li></ul>"):2==t.type&&i.append("<ul><li class='sucmsg'>您的评价已提交！</li></ul>"),i.find(".js-input").remove())}}),!1}})}};$(".consult-detail-box").length>0&&p.init(),$(".J_InsuranceOrder").length>0&&($("#sendForm").validator({formEvent:"null"}),$("#sendCount").on("change",function(){var t=parseInt($(this).val(),10),i="5千";$(".J_TotalPrice").text(20*t),$(".J_TotalMain").text(5*t),i=1!==t?.5*t+"万":"5千",$(".J_TotalExtra").text(i)}),$("#J_Submit").on("click",function(){return $("#sendForm").data("validator").checkValidity()&&$("#sendForm").submit(),!1})),$(".J_InsuranceList").length>0&&$(".J_ShowTip").mouseenter(function(){$(this).offset();$(this).closest(".content").find(".J_TipCtn").show()}).mouseleave(function(){$(this).closest(".content").find(".J_TipCtn").hide()})},[GH.modules.datepicker,GH.modules.jcrop,GH.modules.pagination]);